# -*- coding: utf-8 -*-
"""Untitled1.ipynb

Automatically generated by Colab.

Original file is located at
    https://colab.research.google.com/drive/1q4YyuVCpQnnb4R1oT49vsX3ovS-l57I0
"""

!pip install transformers datasets accelerate --quiet

"""# Sample content creation (run this to test if you don't have a stories.txt file yet)
stories = [
    '''In the attic of an old lighthouse, a girl discovered a map inked on living leaves.
Each night, the map whispered new paths through unseen lands and forgotten oceans.
She followed its trails in her dreams, sailing ships made of glass and fire.
One night, she didn‚Äôt wake up‚Äîonly her empty shoes were found beside the bed.''',

    '''An old clockmaker built timepieces that ticked in strange rhythms no one could understand.
Every hour, his clocks whispered names of people long forgotten.
One day, a stranger arrived whose name matched the whisper of a clock at midnight.
The clockmaker simply smiled and said, ‚ÄúYou‚Äôre right on time.‚Äù'''
]

# Write to file
with open("stories.txt", "w") as f:
    for story in stories:
        f.write(story.strip() + "\n\n")

"""

!pip install datasets transformers

from datasets import load_dataset
from transformers import GPT2Tokenizer

from datasets import Dataset
from transformers import GPT2Tokenizer

# Step 1: Manually read stories from the file
with open("stories.txt", "r", encoding="utf-8") as f:
    stories = f.read().strip().split("\n\n")  # Assuming stories are separated by blank lines

# Step 2: Create a Hugging Face dataset from Python dict
dataset = Dataset.from_dict({"text": stories})

# Step 3: Load tokenizer
tokenizer = GPT2Tokenizer.from_pretrained("distilgpt2")
tokenizer.pad_token = tokenizer.eos_token

# Step 4: Tokenize the dataset
def tokenize_function(example):
    return tokenizer(example["text"], padding="max_length", truncation=True, max_length=128)

tokenized_dataset = dataset.map(tokenize_function, batched=True)

from transformers import AutoTokenizer
tokenizer = AutoTokenizer.from_pretrained("distilgpt2")

import random

while True:
    story = random.choice(dataset)["text"]
    print("\nü§ñ Generated Story:")
    print(story)

    feedback = input("\nDid you like the story? (yes/no): ").strip().lower()

    if feedback == "yes":
        print("Thank you! Have sweet dreams.")
        break
    elif feedback == "no":
        another = input("Do you want me to tell you another one? (yes/no): ").strip().lower()
        if another == "no":
            print("Okay, maybe next time!")
            break
        elif another != "yes":
            print("I didn't understand. Exiting the program.")
            break
    else:
        print("I didn't understand. Exiting the program.")
        break

import random

while True:
    story = random.choice(dataset)["text"]
    print("\nü§ñ Generated Story:")
    print(story)

    feedback = input("\nDid you like the story? (yes/no): ").strip().lower()

    if feedback == "yes":
        print("Thank you! Have sweet dreams.")
        break
    elif feedback == "no":
        another = input("Do you want me to tell you another one? (yes/no): ").strip().lower()
        if another == "no":
            print("Okay, maybe next time!")
            break
        elif another != "yes":
            print("I didn't understand. Exiting the program.")
            break
    else:
        print("I didn't understand. Exiting the program.")
        break
